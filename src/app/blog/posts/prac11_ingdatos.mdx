---
title: "Ingenier√≠a Temporal en E-Commerce: Revelando la Din√°mica Secreta del Comportamiento del Cliente."
publishedAt: "2025-11-03"
tag: "Curso: Ingenier√≠a de Datos"
image: "/practica11/portada.png"
---

# Temporal Feature Engineering en E-commerce: Construcci√≥n de Se√±ales Temporales y Din√°micas de Compra de Clientes.

## Resumen ejecutivo

El an√°lisis realizado se centr√≥ en la aplicaci√≥n de t√©cnicas de ingenier√≠a temporal de features sobre un dataset real de transacciones de e-commerce. El objetivo principal fue comprender la din√°mica de compra de los clientes, empleando herramientas como lags, rolling windows, expanding windows, m√©tricas RFM, diversidad de productos y codificaciones de calendario. El enfoque permiti√≥ enriquecer las secuencias temporales individuales con informaci√≥n relevante acerca de la frecuencia de recompra, tendencias recientes, comportamiento hist√≥rico y estacionalidad. Al mismo tiempo, se cuid√≥ rigurosamente evitar todo tipo de data leakage mediante ordenamientos correctos y desplazamientos controlados por usuario. Los resultados obtenidos revelaron patrones claros de comportamiento, como ciclos de compra mensuales, variaciones en el tama√±o del carrito y diferencias marcadas entre clientes regulares y espor√°dicos.

---

## Contexto general

Esta pr√°ctica corresponde a la Unidad 3 del curso Inteligencia de Datos, espec√≠ficamente al m√≥dulo dedicado a Temporal Feature Engineering. El dataset Online Retail, proveniente de Kaggle, contiene m√°s de quinientas mil transacciones entre diciembre de 2010 y diciembre de 2011, permitiendo estudiar el comportamiento de compra a nivel individual. Cada fila representa un producto dentro de una orden, lo que proporciona un nivel de detalle ideal para analizar fluctuaciones temporales, intervalos entre compras, estacionalidad del consumo y diversidad de los productos adquiridos. El prop√≥sito es convertir una colecci√≥n de registros transaccionales en una serie de features que reflejen la evoluci√≥n del comportamiento del cliente a lo largo del tiempo.

---

## Preparaci√≥n del dataset

El procesamiento inicial consisti√≥ en la descarga del dataset, la eliminaci√≥n de facturas canceladas, valores negativos y clientes sin identificador, y la organizaci√≥n cronol√≥gica de las transacciones por usuario. Luego de la limpieza, el dataset qued√≥ compuesto por 397.884 filas correspondientes a 4.338 clientes √∫nicos. El rango temporal abarca desde el 1 de diciembre de 2010 hasta el 9 de diciembre de 2011, con un total de ventas que supera los ocho millones de d√≥lares. Esta estructura temporal permiti√≥ analizar c√≥mo se comportan los clientes frente a intervalos irregulares entre compras y una frecuencia promedio de poco m√°s de cuatro √≥rdenes por cliente. En esta etapa inicial resulta fundamental entender la varianza temporal del dataset.

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica11/distribucion_ordenes.png"
    alt="Boxplots mostrando diferencias de escala"
    width={800}
    height={400}
  />
</div>

La imagen correspondiente a las √≥rdenes semanales muestra con claridad el comportamiento estacional del sistema, con picos notorios hacia fin de a√±o y fluctuaciones que revelan una din√°mica comercial marcada. La distribuci√≥n de d√≠as entre √≥rdenes indica una mediana cercana a un mes, lo que sugiere un patr√≥n de compra relativamente espor√°dico, aunque con una dispersi√≥n considerable: algunos clientes compran con frecuencia semanal, mientras que otros reaparecen despu√©s de varios meses, generando una heterogeneidad clave para el modelado posterior.

---

## Lags ‚Äì Comportamiento reciente

El c√°lculo de lags mediante groupby y shift permiti√≥ registrar la distancia temporal respecto de compras pasadas sin contaminar usuarios entre s√≠. El lag_1 representa el intervalo entre las dos compras m√°s recientes y resulta fundamental para distinguir clientes que mantienen un h√°bito de compra estable de aquellos con comportamiento imprevisible. Los lags m√°s prolongados ofrecen una visi√≥n m√°s amplia del ritmo de interacci√≥n del usuario con la plataforma, aportando informaci√≥n esencial para modelos que dependen de la predicci√≥n de recurrencia.

---

## Rolling Windows ‚Äì Tendencias recientes

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica11/rollingmean_vs_cartsize.png"
    alt="Boxplots mostrando diferencias de escala"
    width={800}
    height={400}
  />
</div>

La imagen que compara el rolling mean del tama√±o del carrito con los valores reales ayuda a visualizar c√≥mo estas ventanas m√≥viles suavizan la variabilidad de las compras individuales. El rolling mean capta la tendencia inmediata del usuario, revelando si est√° aumentando su volumen de compra o si experimenta oscilaciones pronunciadas. La zona sombreada correspondiente a una desviaci√≥n est√°ndar alrededor del rolling mean evidencia qu√© tan err√°tico o estable es un cliente: aquellos cuyas compras se mantienen dentro de la banda de variaci√≥n muestran patrones consistentes, mientras que quienes exhiben picos o ca√≠das abruptas sugieren comportamientos impulsivos o epis√≥dicos.

---

## Expanding Windows ‚Äì Comportamiento hist√≥rico

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica11/rolling_expandingmean.png"
    alt="Boxplots mostrando diferencias de escala"
    width={900}
    height={400}
  />
</div>

La figura asociada a las expanding windows muestra c√≥mo los promedios y tendencias acumuladas evolutivas reflejan la ‚Äúmemoria‚Äù del comportamiento de cada cliente. A diferencia de las rolling windows, estas acumulaciones no olvidan el pasado, sino que integran toda la historia del usuario. La curva resultante revela si con el tiempo el cliente tiende a estabilizarse en un nivel de compra determinado o si, por el contrario, presenta una evoluci√≥n irregular en la que cada nueva orden puede alterar significativemente el promedio hist√≥rico. Es una medida ideal para caracterizar la fidelidad y la estabilidad del comportamiento de compra.

---

## RFM Aggregations ‚Äì Recency, Frequency, Monetary

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica11/distributions.png"
    alt="Boxplots mostrando diferencias de escala"
    width={1000}
    height={400}
  />
</div>

Las distribuciones RFM permiten analizar tres dimensiones esenciales del comportamiento del cliente. La recency evidencia qu√© tan reciente ha sido la √∫ltima interacci√≥n del usuario con la tienda, mostrando una gran proporci√≥n de clientes inactivos durante largos per√≠odos. La frecuencia exhibe el t√≠pico patr√≥n de cola larga donde pocos usuarios acumulan muchas √≥rdenes y la mayor√≠a mantiene una interacci√≥n m√≠nima. El aspecto monetario presenta igualmente una dispersi√≥n significativa, indicando la coexistencia de clientes de ticket alto y otros de ticket bajo. Estas medidas, utilizadas en conjunto, permiten segmentar a los clientes y anticipar su propensi√≥n a una recompra futura.

---

## Time Windows (7d, 30d, 90d)

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica11/ventas_temporal.png"
    alt="Boxplots mostrando diferencias de escala"
    width={900}
    height={400}
  />
</div>

La visualizaci√≥n de ventanas temporales evidencia c√≥mo la actividad creciente en per√≠odos m√°s amplios contrasta con la baja frecuencia en ventanas reducidas. Los valores de siete d√≠as muestran una actividad casi marginal, lo que refuerza el car√°cter espor√°dico de las compras, mientras que las ventanas de treinta y noventa d√≠as capturan la mayor parte de la recurrencia. El scatter que compara √≥rdenes en noventa d√≠as con √≥rdenes en siete d√≠as revela dos perfiles muy marcados: clientes con alta actividad hist√≥rica pero poca actividad reciente, que representan un riesgo potencial de churn, y clientes reactivados cuya actividad reciente muestra se√±ales de retorno.

---

## Product Diversity

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica11/productdiversitydelivery.png"
    alt="Boxplots mostrando diferencias de escala"
    width={800}
    height={400}
  />
</div>

La imagen que explora la diversidad de productos combina un scatter plot entre total de √≠tems y productos √∫nicos y un histograma del √≠ndice de diversidad. El scatter muestra que muchos clientes realizan compras repetitivas con pocos productos distintos, mientras que un conjunto importante presenta una diversidad notable. El histograma confirma que la mayor√≠a mantiene un ratio elevado, lo que implica un comportamiento exploratorio considerable. Los valores bajos de diversidad, en cambio, indican clientes que retornan con patrones muy definidos, ideales para estrategias de fidelizaci√≥n y recomendaciones espec√≠ficas.

---

## Calendar Features ‚Äì Encoding c√≠clico

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica11/encoding.png"
    alt="Boxplots mostrando diferencias de escala"
    width={900}
    height={400}
  />
</div>

La representaci√≥n gr√°fica del encoding c√≠clico ilustra c√≥mo variables originalmente discretas como la hora o el d√≠a de la semana se transforman en coordenadas sinusoidales que preservan su continuidad natural. En la figura se observan patrones circulares que se√±alan la proximidad entre horas consecutivas y la equivalencia entre domingo y lunes o entre las horas 23 y 0. La comparaci√≥n entre d√≠as de semana y fin de semana en t√©rminos de tama√±o de carrito muestra un incremento claro durante los fines de semana, lo que respalda su inclusi√≥n como variable auxiliar en modelos de predicci√≥n.

---

## External Features ‚Äì Indicadores econ√≥micos simulados

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica11/monthly_orders.png"
    alt="Boxplots mostrando diferencias de escala"
    width={800}
    height={400}
  />
</div>

El gr√°fico que combina √≥rdenes mensuales con el crecimiento del PBI y la confianza del consumidor destaca c√≥mo indicadores externos pueden influir en la demanda. Las variaciones econ√≥micas se correlacionan parcialmente con las fluctuaciones en el volumen de √≥rdenes, y el scatter entre confianza del consumidor y n√∫mero de √≥rdenes sugiere una relaci√≥n positiva moderada: en contextos de mayor optimismo econ√≥mico, los usuarios tienden a gastar m√°s o a comprar con mayor frecuencia. Aunque estas caracter√≠sticas no son determinantes por s√≠ solas, enriquecen el modelo contextualizando la estacionalidad econ√≥mica.

---

## Feature Importance en modelos predictivos

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica11/feature_importance.png"
    alt="Boxplots mostrando diferencias de escala"
    width={800}
    height={400}
  />
</div>

El gr√°fico de importancia de features revela el peso que cada variable aporta al modelo final. Se observa que las variables temporales ‚Äîincluyendo recency, diversidad de productos, rolling windows y ventanas temporales de mediano plazo‚Äî dominan la relevancia. Las caracter√≠sticas basadas en calendario y los indicadores econ√≥micos aportan informaci√≥n adicional pero con un peso comparativamente menor. La interpretaci√≥n de esta figura reafirma que el comportamiento temporal es el componente fundamental para predecir recurrencia o compra futura en entornos de e-commerce.

---

## Evaluaci√≥n del desempe√±o del modelo

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica11/model_performance.png"
    alt="Boxplots mostrando diferencias de escala"
    width={800}
    height={400}
  />
</div>

La comparaci√≥n entre el modelo base y el modelo enriquecido muestra un incremento notable del desempe√±o. El AUC del modelo sin features temporales es significativamente inferior al del modelo con lags, ventanas m√≥viles, expanding windows y variables externas. Este aumento confirma que la incorporaci√≥n de temporalidad no es opcional, sino esencial para capturar la din√°mica real del comportamiento del usuario y mejorar la capacidad predictiva del sistema.

---

## Conclusiones generales

El trabajo realizado demuestra que la dimensi√≥n temporal es indispensable para comprender y modelar el comportamiento de los clientes en plataformas de e-commerce. Las t√©cnicas de ingenier√≠a temporal permiten transformar datos transaccionales aparentemente est√°ticos en secuencias ricas en informaci√≥n din√°mica. Los lags brindan se√±ales inmediatas sobre el ritmo de compra; las rolling windows capturan tendencias recientes; las expanding windows revelan la estabilidad hist√≥rica; las m√©tricas RFM ofrecen una visi√≥n integral del ciclo de vida del cliente; la diversidad de productos caracteriza su comportamiento exploratorio o repetitivo; y el calendario junto con variables externas contextualiza las fluctuaciones del consumo. La conjunci√≥n de todas estas se√±ales permite construir modelos con mayor precisi√≥n y capacidad explicativa, facilitando estrategias de retenci√≥n, recomendaciones personalizadas y estimaciones m√°s fiables de la recurrencia futura.


---

## Evidencias

Para consultar el c√≥digo √≠ntegro, las funciones aplicadas, la generaci√≥n de gr√°ficos y los resultados intermedios de la pr√°ctica, se adjunta el notebook original:

üìé **Google Colab:** [Abrir notebook](https://colab.research.google.com/drive/1Sb1awamzc1X0tiFao7lSx-vvRBqjDlSF?usp=sharing)

---