---
title: "M√°s All√° del Preprocesamiento y Extracci√≥n de Features: Un Pipeline Integrado para Evaluaci√≥n de Calidad en Im√°genes."
publishedAt: "2025-11-17"
tag: "Curso: Ingenier√≠a de Datos"
image: "/practica13/portada.jpg"
---


# Robustez geom√©trica y comparaci√≥n ORB vs SIFT

## Introducci√≥n

Este bonus extiende la pr√°ctica original incorporando un an√°lisis espec√≠fico de **robustez geom√©trica** de los descriptores locales ORB y SIFT frente a transformaciones controladas de la imagen. El objetivo es responder una pregunta clave en visi√≥n por computador aplicada: ¬øhasta qu√© punto un detector‚Äìdescriptor de puntos clave mantiene su capacidad de ‚Äúreconocer‚Äù la misma escena cuando la imagen sufre rotaciones, cambios de escala o deformaciones de perspectiva?

Para ello se parte de la misma imagen de trabajo que en la pr√°ctica base, sobre la cual se aplican dos variantes de preprocesamiento coherentes con los mejores resultados previos: una versi√≥n en escala de grises directamente derivada de la imagen original y una versi√≥n mejorada mediante **CLAHE**, que hab√≠a demostrado mejorar el contraste y la definici√≥n de bordes. A partir de estas dos versiones se generan im√°genes transformadas y se eval√∫a, para cada combinaci√≥n de preprocesamiento, transformaci√≥n geom√©trica y descriptor (ORB o SIFT), cu√°ntos matches v√°lidos se obtienen entre la imagen base y la imagen transformada, as√≠ como la calidad promedio de esos emparejamientos.

El resultado es un mini‚Äìdashboard de robustez que no solo cuantifica el comportamiento de ORB y SIFT, sino que permite interpretar de forma visual c√≥mo reaccionan frente a rotaciones moderadas (15¬∞ y 45¬∞), escalados (0.8 y 1.2) y una deformaci√≥n en perspectiva. A partir de los scores agregados se derivan tambi√©n indicadores de QA global que pueden usarse como ‚Äúsem√°foro‚Äù de robustez para futuros pipelines de visi√≥n.

---

## Marco te√≥rico

Los descriptores locales se basan en la idea de identificar, alrededor de ciertos puntos clave de la imagen, patrones de intensidad que sean relativamente invariables ante cambios de vista. Cuando una imagen se rota o se escala, el contenido global cambia, pero ciertos puntos ‚Äîesquinas, intersecciones, texturas distintivas‚Äî se mantienen reconocibles si el descriptor es suficientemente robusto.

**ORB (Oriented FAST and Rotated BRIEF)** es un descriptor binario dise√±ado para ser eficiente en tiempo de c√≥mputo y adecuado para aplicaciones en tiempo real. Se apoya en el detector FAST para localizar puntos clave y utiliza BRIEF rotado para describir el entorno local mediante comparaciones binarias de intensidad. Esto lo vuelve muy veloz, con descriptores compactos que se comparan mediante distancias Hamming.

**SIFT (Scale-Invariant Feature Transform)**, por su parte, fue concebido para lograr invariancia robusta a escala y rotaci√≥n, utilizando pir√°mides de escala, aproximaci√≥n de LoG (Difference of Gaussians) y descriptores basados en histogramas de gradientes. Sus descriptores son m√°s largos y se comparan mediante distancias L2, lo que implica mayor costo computacional pero tambi√©n una gran estabilidad en escenarios complejos.

La **robustez geom√©trica** se eval√∫a aqu√≠ mediante dos ideas centrales:

* El n√∫mero de matches obtenidos entre la imagen base y la transformada.
* El **ratio de matches** (`matches_ratio`), definido como el n√∫mero de matches dividido por el m√≠nimo entre el n√∫mero de keypoints de cada imagen. Este ratio resume cu√°n consistente es el descriptor para ‚Äúreencontrar‚Äù los puntos clave bajo transformaciones.

Adem√°s, se construye un **score global de robustez** (`robust_score`) calculado como el promedio del `matches_ratio` sobre todas las transformaciones evaluadas para cada combinaci√≥n de preprocesamiento y descriptor. De esta forma se puede clasificar la robustez como baja, media o alta seg√∫n umbrales sugeridos (`<0.3`, `0.3‚Äì0.6`, `>0.6` respectivamente). 

---

## Preprocesamiento y visualizaci√≥n inicial

Antes de aplicar las transformaciones geom√©tricas se preparan dos variantes de la imagen:

1. **Imagen original en escala de grises**, obtenida tras convertir la imagen RGB a `img_gray`.
2. **Imagen mejorada con CLAHE**, donde se aplica ecualizaci√≥n adaptativa de histograma sobre el canal L del espacio LAB y luego se vuelve a convertir a RGB y a escala de grises (`img_clahe_gray`). 

Estas dos versiones se visualizan lado a lado para comprobar que la aplicaci√≥n de CLAHE incrementa el contraste local y la definici√≥n de detalles sin introducir artefactos visibles.

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica13/bonus1.png"
    alt="Boxplots mostrando diferencias de escala"
    width={800}
    height={280}
  />
</div>

En la imagen de control se aprecia que la versi√≥n CLAHE realza contornos y texturas, especialmente en zonas de baja iluminaci√≥n o bajo contraste, lo que en principio deber√≠a facilitar la detecci√≥n de puntos clave y mejorar la repetibilidad de los descriptores ante peque√±as variaciones geom√©tricas.

---

## Dise√±o del experimento de robustez

El n√∫cleo del bonus consiste en aplicar una serie de **transformaciones geom√©tricas controladas** a cada versi√≥n de la imagen (original y CLAHE) y medir la capacidad de ORB y SIFT para encontrar correspondencias:

* `rot15`: rotaci√≥n de 15 grados alrededor del centro.
* `rot45`: rotaci√≥n de 45 grados.
* `scale0.8`: escalado isotr√≥pico al 80 % del tama√±o original.
* `scale1.2`: escalado al 120 %.
* `persp`: deformaci√≥n en perspectiva mediante cuatro puntos desplazados en los extremos. 

Para cada combinaci√≥n de preprocesamiento, transformaci√≥n y descriptor se ejecuta una funci√≥n `benchmark_descriptors` que:

1. Detecta keypoints y calcula descriptores en la imagen base y en la transformada.
2. Realiza matching utilizando un `BFMatcher` apropiado para cada tipo de descriptor (Hamming para ORB, L2 para SIFT).
3. Ordena los matches por distancia y calcula:

   * tiempos de detecci√≥n y matching,
   * n√∫mero de keypoints en cada imagen,
   * n√∫mero de matches,
   * distancia promedio,
   * ratio de matches (`matches_ratio`).

Los resultados se almacenan en un `DataFrame` que sintetiza todo el experimento para su an√°lisis posterior. 

---

## Resultados num√©ricos detallados

La primera tabla resume, para cada combinaci√≥n de preprocesamiento, transformaci√≥n y descriptor, el ratio de matches obtenido y la distancia promedio de los emparejamientos. (Los tiempos de detecci√≥n y matching tambi√©n est√°n disponibles, pero aqu√≠ se prioriza la calidad geom√©trica.)


<table>
  <thead>
    <tr>
      <th>Prep</th>
      <th>Transformaci√≥n</th>
      <th>Descriptor</th>
      <th>matches_ratio</th>
      <th>avg_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>orig</td><td>rot15</td><td>ORB</td><td>0.664</td><td>20.63</td></tr>
    <tr><td>orig</td><td>rot15</td><td>SIFT</td><td>0.679</td><td>65.25</td></tr>

    <tr><td>orig</td><td>rot45</td><td>ORB</td><td>0.441</td><td>25.70</td></tr>
    <tr><td>orig</td><td>rot45</td><td>SIFT</td><td>0.647</td><td>78.32</td></tr>

    <tr><td>orig</td><td>scale0.8</td><td>ORB</td><td>0.652</td><td>19.71</td></tr>
    <tr><td>orig</td><td>scale0.8</td><td>SIFT</td><td>0.739</td><td>58.67</td></tr>

    <tr><td>orig</td><td>scale1.2</td><td>ORB</td><td>0.758</td><td>5.45</td></tr>
    <tr><td>orig</td><td>scale1.2</td><td>SIFT</td><td>0.744</td><td>63.50</td></tr>

    <tr><td>orig</td><td>persp</td><td>ORB</td><td>0.528</td><td>23.42</td></tr>
    <tr><td>orig</td><td>persp</td><td>SIFT</td><td>0.662</td><td>81.69</td></tr>

    <tr><td>clahe</td><td>rot15</td><td>ORB</td><td>0.662</td><td>21.49</td></tr>
    <tr><td>clahe</td><td>rot15</td><td>SIFT</td><td>0.684</td><td>69.25</td></tr>

    <tr><td>clahe</td><td>rot45</td><td>ORB</td><td>0.494</td><td>24.77</td></tr>
    <tr><td>clahe</td><td>rot45</td><td>SIFT</td><td>0.637</td><td>80.21</td></tr>

    <tr><td>clahe</td><td>scale0.8</td><td>ORB</td><td>0.640</td><td>21.76</td></tr>
    <tr><td>clahe</td><td>scale0.8</td><td>SIFT</td><td>0.700</td><td>58.61</td></tr>

    <tr><td>clahe</td><td>scale1.2</td><td>ORB</td><td>0.744</td><td>6.28</td></tr>
    <tr><td>clahe</td><td>scale1.2</td><td>SIFT</td><td>0.739</td><td>61.06</td></tr>

    <tr><td>clahe</td><td>persp</td><td>ORB</td><td>0.470</td><td>25.08</td></tr>
    <tr><td>clahe</td><td>persp</td><td>SIFT</td><td>0.642</td><td>81.91</td></tr>
  </tbody>
</table>

La tabla muestra un patr√≥n consistente: para cada transformaci√≥n, **SIFT** tiende a obtener un `matches_ratio` ligeramente superior al de ORB, lo que indica mayor estabilidad ante cambios geom√©tricos. Sin embargo, ORB obtiene distancias promedio m√°s bajas en algunos casos, lo que sugiere que, aunque halle menos correspondencias, estas son en promedio m√°s ‚Äúcercanas‚Äù en el espacio del descriptor. Adem√°s, las transformaciones de rotaci√≥n fuerte (rot45) y perspectiva son las que m√°s degradan el ratio de matches, especialmente para ORB, lo que confirma que son escenarios m√°s desafiantes.

---

## Mini-dashboard de robustez y comparaci√≥n visual

Para sintetizar el comportamiento de ORB y SIFT se construye un **mini-dashboard** con dos gr√°ficos de barras: uno para la imagen original y otro para la versi√≥n CLAHE, donde se grafican los `matches_ratio` de ORB y SIFT para cada transformaci√≥n. 

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica13/bonus2.png"
    alt="Boxplots mostrando diferencias de escala"
    width={800}
    height={400}
  />
</div>

En estos gr√°ficos se aprecia claramente que SIFT domina la mayor parte de los escenarios, especialmente en rotaciones fuertes y en la deformaci√≥n en perspectiva. ORB, en cambio, se comporta muy bien en escalados suaves (especialmente `scale1.2`), donde alcanza ratios cercanos o superiores a 0.75. La diferencia entre usar la imagen original o la versi√≥n CLAHE no es dram√°tica: los promedios cambian poco, pero se observa una ligera mejora en algunos casos para SIFT y un comportamiento m√°s estable en los escalados.

Para completar el an√°lisis se generan im√°genes que muestran, de forma expl√≠cita, los matches de ORB y SIFT bajo una transformaci√≥n representativa, en este caso la rotaci√≥n de 45 grados:

<div style={{ display: "flex", justifyContent: "center", margin: "24px 0" }}>
  <Image
    src="/practica13/bonus3.png"
    alt="Boxplots mostrando diferencias de escala"
    width={800}
    height={200}
  />
</div>

En la visualizaci√≥n se observa que SIFT consigue una malla de correspondencias m√°s densa y mejor distribuida a lo largo de la imagen, mientras que ORB presenta un n√∫mero menor de l√≠neas de emparejamiento, aunque muchas de ellas son precisas. Esta diferencia visual respalda los resultados num√©ricos de la tabla y del mini-dashboard.

---

## Scores agregados de robustez

A partir del `DataFrame` completo se calculan scores agregados promediando `matches_ratio` sobre todas las transformaciones, para cada combinaci√≥n de preprocesamiento y descriptor. El resultado se presenta en la siguiente tabla:

<table>
  <thead>
    <tr>
      <th>Preprocesamiento</th>
      <th>Descriptor</th>
      <th>robust_score</th>
      <th>Nivel de robustez</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>clahe</td>
      <td>ORB</td>
      <td>0.602</td>
      <td>ALTA</td>
    </tr>
    <tr>
      <td>clahe</td>
      <td>SIFT</td>
      <td>0.680</td>
      <td>ALTA</td>
    </tr>
    <tr>
      <td>orig</td>
      <td>ORB</td>
      <td>0.609</td>
      <td>ALTA</td>
    </tr>
    <tr>
      <td>orig</td>
      <td>SIFT</td>
      <td>0.694</td>
      <td>ALTA</td>
    </tr>
  </tbody>
</table>

Todos los `robust_score` se encuentran por encima de 0.6, lo que los coloca en la categor√≠a de **robustez alta** frente a las transformaciones consideradas. La diferencia principal es que SIFT presenta los valores m√°s altos, tanto en la imagen original como en la versi√≥n CLAHE, confirmando su superioridad en t√©rminos de invariancia geom√©trica. ORB, no obstante, mantiene scores muy respetables, lo que lo convierte en una alternativa atractiva cuando el tiempo de c√≥mputo o las restricciones de memoria son factores cr√≠ticos.

---

## Conclusiones del bonus

El bonus de robustez geom√©trica complementa la pr√°ctica original mostrando que la elecci√≥n del descriptor local tiene un impacto directo en la capacidad del sistema de visi√≥n para operar en escenarios realistas donde la c√°mara puede rotar, cambiar de escala o sufrir peque√±as deformaciones de perspectiva. Los resultados indican que:

* **SIFT** ofrece la mayor robustez global, con los `robust_score` m√°s altos y una malla de correspondencias m√°s densa y estable en las visualizaciones.
* **ORB** es competitivo, especialmente en escalados, y logra una combinaci√≥n atractiva de rapidez y razonable invariancia, aunque sufre m√°s en rotaciones fuertes y perspectiva.
* El preprocesamiento con **CLAHE** mejora ligeramente algunos casos, pero no altera radicalmente el ranking entre descriptores; su contribuci√≥n principal es homogeneizar el contraste y facilitar la detecci√≥n consistente de puntos clave.

En conjunto, el pipeline de evaluaci√≥n desarrollado en este bonus proporciona una herramienta robusta para **auditar la invariancia geom√©trica** de distintos descriptores bajo condiciones controladas, y sienta las bases para incorporar estos indicadores como parte de una estrategia de QA sistem√°tica en proyectos de visi√≥n por computador.

---
## Evidencias

Para consultar el c√≥digo √≠ntegro, las funciones aplicadas, la generaci√≥n de gr√°ficos y los resultados intermedios de la pr√°ctica, se adjunta el notebook original:

üìé **Google Colab:** [Abrir notebook](https://colab.research.google.com/drive/1g9N-VTocQU-hB4ONi3bSoL115JyEmPOU?usp=sharing)

---